{# templates/items_explorer.html #}
{% extends "base.html" %}

{% block content %}
<div class="pt-4">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h3 class="mb-0">Items Explorer</h3>
      <div class="text-secondary small">
        Search items and quickly understand activity: average demand, last sold time, and trend.
      </div>
    </div>

    <a href="/items" class="btn btn-outline-secondary btn-sm">
      <i class="bi bi-grid"></i> Back to Items
    </a>
  </div>

  <!-- Search + Filters -->
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <div class="row g-3 align-items-end">

        <div class="col-12 col-lg-6">
          <label class="form-label mb-1">
            Search
            <i class="bi bi-info-circle ms-1 text-secondary"
               data-bs-toggle="tooltip"
               data-bs-title="Search by item title or item code.
Example: 'water' or '500' or an exact code.
The table updates when you press Search."></i>
          </label>
          <input type="text" class="form-control" id="ix-search"
                 placeholder="Search by item name or code...">
          <div class="form-text">
            This finds items by name/code and ranks them by recent activity.
          </div>
        </div>

        <div class="col-12 col-lg-2">
          <label class="form-label mb-1">
            Sold in last
            <i class="bi bi-info-circle ms-1 text-secondary"
               data-bs-toggle="tooltip"
               data-bs-title="Lookback window used to compute average/day, last sold, and trend.
30 days is a good default. 7 days is more reactive. 90 days shows long-term demand."></i>
          </label>
          <select class="form-select" id="ix-days">
            <option value="7">7 days</option>
            <option value="30" selected>30 days</option>
            <option value="90">90 days</option>
          </select>
          <div class="form-text">Controls the analysis window.</div>
        </div>

        <div class="col-12 col-lg-2">
          <label class="form-label mb-1">
            Trend
            <i class="bi bi-info-circle ms-1 text-secondary"
               data-bs-toggle="tooltip"
               data-bs-title="Trend compares the latest business day vs the previous business day in the same window.
Up means demand increased, Down decreased, Flat means no meaningful change."></i>
          </label>
          <select class="form-select" id="ix-trend">
            <option value="">All</option>
            <option value="up">Rising</option>
            <option value="down">Falling</option>
            <option value="flat">Flat</option>
          </select>
          <div class="form-text">Latest day vs previous day.</div>
        </div>

        <div class="col-12 col-lg-2">
          <button class="btn btn-primary w-100" id="ix-run">
            <i class="bi bi-search"></i> Search
          </button>
          <div class="form-text text-center mt-1" id="ix-status"></div>
        </div>

        <div class="col-12">
          <button class="btn btn-link px-0" type="button" data-bs-toggle="collapse" data-bs-target="#ix-filters">
            <i class="bi bi-funnel"></i> More filters
          </button>
        </div>

        <div class="col-12 collapse" id="ix-filters">
          <div class="row g-3">
            <div class="col-12 col-lg-4">
              <label class="form-label mb-1">
                Subgroup
                <i class="bi bi-info-circle ms-1 text-secondary"
                   data-bs-toggle="tooltip"
                   data-bs-title="Filters results to a specific subgroup (category).
This helps when you want to review only 'Drinks' or 'Snacks' for example."></i>
              </label>
              <input type="text" class="form-control" id="ix-subgroup" placeholder="e.g. Drinks">
              <div class="form-text">
                Optional. Leave empty to include all subgroups.
              </div>
            </div>

            <div class="col-12 col-lg-4">
              <label class="form-label mb-1">
                Limit
                <i class="bi bi-info-circle ms-1 text-secondary"
                   data-bs-toggle="tooltip"
                   data-bs-title="Maximum number of rows returned.
Higher limits show more items but can be slower. 500 is a safe default."></i>
              </label>
              <input type="number" class="form-control" id="ix-limit" value="500" min="50" max="2000">
              <div class="form-text">
                Safety clamp exists server-side to prevent abuse.
              </div>
            </div>

            <div class="col-12 col-lg-4 d-flex align-items-end">
              <button class="btn btn-outline-secondary w-100" id="ix-reset">
                <i class="bi bi-arrow-counterclockwise"></i> Reset
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Results -->
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h6 class="mb-0">
          Results
          <i class="bi bi-info-circle ms-1 text-secondary"
             data-bs-toggle="tooltip"
             data-bs-title="Each row summarizes the item's activity within the selected lookback window.
Avg/day is a baseline, Last sold builds trust, Trend is a quick signal."></i>
        </h6>
        <span class="small text-secondary" id="ix-count"></span>
      </div>

      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle" id="ix-table" style="width:100%">
          <thead>
            <tr>
              <th>Item</th>
              <th>Subgroup</th>
              <th class="text-end">Avg / day</th>
              <th>Last sold</th>
              <th>Trend</th>
              <th class="text-end">Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="form-text">
        Avg/day is computed from total quantity in the window divided by number of days in the window.
Trend compares the latest business day vs the previous business day.
      </div>
    </div>
  </div>

</div>

<!-- Page module -->
<script src="{{ url_for('static', filename='js/items_explorer.js') }}"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (window.ItemsExplorer && typeof window.ItemsExplorer.init === "function") {
      window.ItemsExplorer.init();
    }
  });
</script>
{% endblock %}
