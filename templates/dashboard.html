{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
    <h2 class="mb-4">üßæ Daily Closing ‚Äî {{ today.strftime('%B %d, %Y') }}</h2>

    <!-- Sales Input Form -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form method="POST" action="{{ url_for('daily_close') }}">
                <div class="row align-items-end">
                    <div class="col-md-4">
                        <div class="alert alert-secondary shadow-sm text-center">
                            You're submitting a closing for:</br> <strong>{{ suggested_date.strftime('%A, %B %d, %Y')
                                }}</strong>
                        </div>
                        <label for="sales" class="form-label fw-bold">Today's Sales (USD)</label>
                        <input type="number" name="sales" id="sales" class="form-control" min="0" step="0.01" required
                            value="{{ suggested_sale }}">
                    </div>
                    <div class="col-md-4">
                        <label for="date" class="form-label">Closing Date</label>
                        <input type="date" name="date" class="form-control" required value="{{ suggested_date }}">
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-success mt-3 w-100">Submit Closing</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Today's Allocation -->
    {% if last_data %}
    <div class="mb-4">
        <h5 class="mb-2 text-muted">
            üìå Last Recorded Closing ‚Äî {{ last_closing.date.strftime('%B %d, %Y') }}
            <span class="ms-2 badge bg-light text-dark">Sales: ${{ "%.2f"|format(last_closing.sales_cents /
                100)}}</span>
        </h5>

        <div class="row">
            <div class="col-md-3">
                <div class="alert alert-primary shadow-sm">üí∏ Fixed: ${{ "%.2f"|format(last_data.fixed) }}</div>
            </div>
            <div class="col-md-3">
                <div class="alert alert-warning shadow-sm">üõ†Ô∏è Ops: ${{ "%.2f"|format(last_data.ops) }}</div>
            </div>
            <div class="col-md-3">
                <div class="alert alert-info shadow-sm">üì¶ Inventory: ${{ "%.2f"|format(last_data.inventory) }}</div>
            </div>
            <div class="col-md-3">
                <div class="alert alert-success shadow-sm">üß† Buffer: ${{ "%.2f"|format(last_data.buffer) }}</div>
            </div>
        </div>
    </div>
    {% endif %}


    <!-- Envelope Balances -->
    <h4 class="mt-5 mb-3">üí∞ Envelopes</h4>
    <div class="row">
        {% for e in envelopes %}
        <div class="col-md-3 mb-3">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h5>{{ e.name }}</h5>
                    <p class="fs-4 fw-bold text-success">${{ "%.2f"|format(e.balance_cents / 100) }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Recent Closings -->
    <h4 class="mt-5 mb-3">üìÖ Last 5 Closings</h4>
    <table class="table table-bordered bg-white shadow-sm">
        <thead class="table-light">
            <tr>
                <th>Date</th>
                <th>Sales</th>
                <th>Fixed</th>
                <th>Ops</th>
                <th>Inventory</th>
                <th>Buffer</th>
            </tr>
        </thead>
        <tbody>
            {% for c in closings[:5] %}
            <tr>
                <td>{{ c.date }}</td>
                <td>${{ "%.2f"|format(c.sales_cents / 100) }}</td>
                <td>${{ "%.2f"|format(c.fixed_allocation_cents / 100) }}</td>
                <td>${{ "%.2f"|format(c.ops_allocation_cents / 100) }}</td>
                <td>${{ "%.2f"|format(c.inventory_allocation_cents / 100) }}</td>
                <td>${{ "%.2f"|format(c.buffer_allocation_cents / 100) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Fixed Bills Summary -->
    <h4 class="mt-5 mb-3">üìë Fixed Bills</h4>
    <table class="table table-bordered bg-white shadow-sm">
        <thead class="table-light">
            <tr>
                <th>Name</th>
                <th>Monthly Amount</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for bill in bills %}
            <tr>
                <td>{{ bill.name }}</td>
                <td>${{ "%.2f"|format(bill.monthly_amount_cents / 100) }}</td>
                <td>
                    {% if bill.is_active %}
                    <span class="badge bg-success">Active</span>
                    {% else %}
                    <span class="badge bg-secondary">Inactive</span>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3" class="text-center text-muted">No fixed bills yet</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>


</div>
{% endblock %}