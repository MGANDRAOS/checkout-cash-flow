{% extends "base.html" %}
{% block content %}
<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>ðŸ§¾ Expenses</h2>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <form method="POST" class="row g-3 align-items-end">
        <!-- Date -->
        <div class="col-md-2">
          <label class="form-label">Date</label>
          <input type="date" name="date" class="form-control" value="{{ (today or None) or '' }}" required>
        </div>
        <!-- Description -->
        <div class="col-md-3">
          <label class="form-label">Description</label>
          <input type="text" name="description" class="form-control" placeholder="e.g., Pepsi restock" required>
        </div>
        <!-- Amount -->
        <div class="col-md-2">
          <label class="form-label">Amount (USD)</label>
          <input type="number" step="0.01" name="amount" class="form-control" placeholder="0.00" required>
        </div>
        <!-- Envelope -->
        <div class="col-md-2">
          <label class="form-label">Envelope</label>
          <select name="envelope_code" class="form-select" required>
            {% for e in envelopes %}
              <option value="{{ e.code }}">{{ e.name }}</option>
            {% endfor %}
          </select>
        </div>
        <!-- Optional bill link -->
        <div class="col-md-3">
          <label class="form-label">Link to Bill (optional)</label>
          <select name="bill_id" class="form-select">
            <option value="">â€”</option>
            {% for b in bills %}
              <option value="{{ b.id }}">{{ b.name }} ({{ '%.2f' % (b.monthly_amount_cents/100) }})</option>
            {% endfor %}
          </select>
        </div>

        <!-- Row 2 -->
        <div class="col-md-2">
          <label class="form-label">Category</label>
          <input type="text" name="category" class="form-control" placeholder="Restock / Cleaning / ...">
        </div>
        <div class="col-md-2">
          <label class="form-label">Vendor</label>
          <input type="text" name="vendor" class="form-control">
        </div>
        <div class="col-md-2">
          <label class="form-label">Method</label>
          <input type="text" name="payment_method" class="form-control" placeholder="Cash / Transfer">
        </div>
        <div class="col-md-2 text-end">
          <button type="submit" class="btn btn-success w-100 fw-bold">Add Expense</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="mb-3">Recent Expenses</h5>
      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>Date</th>
              <th>Description</th>
              <th>Envelope</th>
              <th>Amount</th>
              <th>Category</th>
              <th>Vendor</th>
              <th>Bill</th>
            </tr>
          </thead>
          <tbody>
            {% for x in expenses %}
              <tr>
                <td>{{ x.date }}</td>
                <td>{{ x.description }}</td>
                <td>{{ x.envelope.code }}</td>
                <td>${{ '%.2f' % (x.amount_cents/100) }}</td>
                <td>{{ x.category or 'â€”' }}</td>
                <td>{{ x.vendor or 'â€”' }}</td>
                <td>{{ x.bill.name if x.bill else 'â€”' }}</td>
              </tr>
            {% else %}
              <tr><td colspan="7" class="text-center text-muted">No expenses yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
